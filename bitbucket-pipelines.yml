image: node:18

options:
  max-time: 30

pipelines:
  branches:
    main:
      - step:
          name: Build & Deploy (Kudu ZIP Deploy)
          caches:
            - node
          script:
            # 1) Install dependencies and build
            - npm ci
            - npm run build

            # 2) Package the contents of out/ at the ZIP root
            - cd out && zip -r ../out-deploy.zip . && cd ..

            # 3) Deploy via Kudu ZIP push using publish profile credentials
            - >
              curl -X POST "https://$PUBLISH_URL/api/zipdeploy"
              -u "$USER:$PWD"
              --data-binary @out-deploy.zip
