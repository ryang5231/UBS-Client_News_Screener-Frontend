image: node:18

options:
  max-time: 30

pipelines:
  branches:
    main:
      - step:
          name: Build & Deploy (Kudu ZIP Deploy)
          deployment: production
          caches:
            - node
          script:
            - apt-get update && apt-get install -y zip unzip
            - npm ci
            - npm run build
            - cd out && zip -r ../out-deploy.zip . && cd ..
            - curl -X POST -u "$USER:$PWD" -T out-deploy.zip "https://$PUBLISH_URL/api/zipdeploy"
